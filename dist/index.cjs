"use strict";var R=Object.defineProperty;var O=(e,t,o)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var c=(e,t,o)=>(O(e,typeof t!="symbol"?t+"":t,o),o),M=(e,t,o)=>{if(!t.has(e))throw TypeError("Cannot "+o)};var r=(e,t,o)=>(M(e,t,"read from private field"),o?o.call(e):t.get(e)),y=(e,t,o)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,o)},L=(e,t,o,i)=>(M(e,t,"write to private field"),i?i.call(e,o):t.set(e,o),o);var b=(e,t,o)=>(M(e,t,"access private method"),o);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const n=require("vue"),B=require("pinia");class A{constructor(t,o,i){c(this,"element");c(this,"cb");c(this,"settings");c(this,"listener",function(t){typeof this.cb=="function"&&t.deltaY&&this.cb({dir:t.deltaY/Math.abs(t.deltaY),wheel:t.deltaY*this.settings.wheelIntensity})}.bind(this));this.element=t,this.cb=o,this.settings=i,this.subscribe()}subscribe(){this.element.addEventListener("wheel",this.listener)}unsubscribe(){this.element.removeEventListener("wheel",this.listener)}}var d,m,N,x,w,k,E,_,I,g;class z{constructor(t,o,i){y(this,N);y(this,w);y(this,E);y(this,I);y(this,d,{sY:0,eY:0});c(this,"prevY",0);y(this,m,void 0);c(this,"cb");c(this,"deltaY");c(this,"minDelta");c(this,"settings");this.cb=o,L(this,m,t),b(this,N,x).call(this),this.settings=i,this.minDelta=i.minTouchmoveDistance,this.useCallback=this.useCallback.bind(this),this.destroy=this.destroy.bind(this)}destroy(){r(this,m).removeEventListener("touchstart",b(this,w,k),!1),r(this,m).removeEventListener("touchmove",b(this,E,_),!1),r(this,m).removeEventListener("touchend",b(this,I,g),!1)}useCallback(t){typeof this.cb=="function"&&t&&this.cb({dir:t/Math.abs(t),wheel:t*this.settings.touchmoveIntensity})}}d=new WeakMap,m=new WeakMap,N=new WeakSet,x=function(){r(this,m).addEventListener("touchstart",b(this,w,k).bind(this),!1),r(this,m).addEventListener("touchmove",b(this,E,_).bind(this),!1),r(this,m).addEventListener("touchend",b(this,I,g).bind(this),!1)},w=new WeakSet,k=function(t){const o=t.touches[0];r(this,d).sY=o.screenY,this.prevY=r(this,d).sY,r(this,d).eY=r(this,d).sY},E=new WeakSet,_=function(t){const o=t.touches[0];this.prevY=r(this,d).eY,r(this,d).eY=o.screenY,this.deltaY=r(this,d).sY-r(this,d).eY;const i=r(this,d).sY-this.prevY;Math.abs(i)>Math.abs(this.deltaY)&&(r(this,d).sY=this.prevY),Math.abs(this.deltaY)>this.minDelta&&this.useCallback(this.deltaY)},I=new WeakSet,g=function(t){Math.abs(this.deltaY)>this.minDelta&&this.useCallback(this.deltaY)};class j{constructor(t,o,i){c(this,"swipe");c(this,"scroll");c(this,"keyboard");c(this,"callback");if(!t){console.error("[Detector]: dom element is required");return}const l={wheelIntensity:i.wheelIntensity||1,touchmoveIntensity:i.touchmoveIntensity||1,minTouchmoveDistance:i.minTouchmoveDistance||40};this.callback=o||(()=>{}),this.scroll=new A(t,this.controlScroll.bind(this),l),this.swipe=new z(t,this.controlScroll.bind(this),l),this.destroy=this.destroy.bind(this)}controlScroll(t){this.callback(t)}destroy(){this.scroll.unsubscribe(),this.swipe.destroy()}}const H=(e,t=0)=>{const o=n.ref(!0),i=n.ref(performance.now());n.onMounted(()=>l(0)),n.onUnmounted(()=>o.value=!1);function l(s){o.value&&(s-i.value>t&&(e(),i.value=performance.now()),requestAnimationFrame(l))}},U=(e,t,o=.2)=>e+(t-e)*o,W=B.defineStore("privateSmoothPage",()=>{const e=n.ref(0),t=n.ref(0),o=n.ref(!1),i=n.ref(!1),l=n.ref(!1),s=n.ref(!1),f=n.ref("desktop"),P=n.ref(!1),p=a=>{e.value=a},C=a=>{i.value=a},Y=a=>{t.value=a},D=a=>{o.value=a},T=a=>{l.value=a},h=a=>{s.value=a},u=a=>{f.value=a},v=a=>{P.value=a};return{currentScrollPosition:e,isEnabled:i,nextScrollPosition:t,isTriggeringScrollPosition:o,isMounted:l,isInited:s,deviceType:f,needReload:P,setCurrentScrollPosition:p,setIsEnabled:C,setNextScrollPosition:Y,setIsTriggeringScrollPosition:D,setIsMounted:T,setIsInited:h,setDeviceType:u,setNeedReload:v,reload:(a=!1)=>{v(!0),a&&(p(0),Y(0))}}});function $(){const e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"mobile":"desktop"}const F=e=>{var t,o,i,l,s,f;return{smoothness:(e==null?void 0:e.smoothness)||.075,wheelIntensity:(e==null?void 0:e.wheelIntensity)||4,touchmoveIntensity:(e==null?void 0:e.touchmoveIntensity)||4,minTouchmoveDistance:(e==null?void 0:e.minTouchmoveDistance)||40,minWidth:(e==null?void 0:e.minWidth)||0,renderDelay:(e==null?void 0:e.renderDelay)||0,enableOnTouchDevices:(e==null?void 0:e.enableOnTouchDevices)||!0,defaultClassNames:{smoothPage:((t=e==null?void 0:e.defaultClassNames)==null?void 0:t.smoothPage)||"t-smoothpage",smoothPageBody:((o=e==null?void 0:e.defaultClassNames)==null?void 0:o.smoothPageBody)||"t-smoothpage--body",smoothPageEnabled:((i=e==null?void 0:e.defaultClassNames)==null?void 0:i.smoothPageEnabled)||"t-smoothpage--enabled"},additionalClassNames:{smoothPage:((l=e==null?void 0:e.additionalClassNames)==null?void 0:l.smoothPage)||"",smoothPageBody:((s=e==null?void 0:e.additionalClassNames)==null?void 0:s.smoothPageBody)||"",smoothPageEnabled:((f=e==null?void 0:e.additionalClassNames)==null?void 0:f.smoothPageEnabled)||""}}},q=n.defineComponent({__name:"index",props:{preventScroll:{type:Boolean,default:!1},settings:null},setup(e){const t=e,o=n.inject("smoothPageSettings"),i=F(o),l=n.computed(()=>({...i,...t==null?void 0:t.settings})),s=W(),f=n.ref(null),P=n.ref(null);n.onMounted(()=>{s.setDeviceType($()),s.setIsEnabled(D()),s.setIsMounted(!0)}),n.onUnmounted(()=>{s.setIsMounted(!1)}),n.watchEffect(()=>{if(s.isEnabled&&!s.isInited){p();return}!s.isEnabled&&s.isInited&&C()});function p(){var h,u,v,S;l.value.defaultClassNames.smoothPageEnabled&&((u=(h=document.querySelector("html"))==null?void 0:h.classList)==null||u.add(l.value.defaultClassNames.smoothPageEnabled)),l.value.additionalClassNames.smoothPageEnabled&&((S=(v=document.querySelector("html"))==null?void 0:v.classList)==null||S.add(l.value.additionalClassNames.smoothPageEnabled)),f.value=new j(document,Y,{wheelIntensity:l.value.wheelIntensity,touchmoveIntensity:l.value.touchmoveIntensity,minTouchmoveDistance:l.value.minTouchmoveDistance}),s.setIsInited(!0)}function C(){var h,u,v,S,a;l.value.defaultClassNames.smoothPageEnabled&&((u=(h=document.querySelector("html"))==null?void 0:h.classList)==null||u.remove(l.value.defaultClassNames.smoothPageEnabled)),l.value.additionalClassNames.smoothPageEnabled&&((S=(v=document.querySelector("html"))==null?void 0:v.classList)==null||S.remove(l.value.additionalClassNames.smoothPageEnabled)),(a=f.value)==null||a.destroy(),s.setIsInited(!1)}n.watchEffect(()=>{s.needReload&&(C(),setTimeout(()=>{p(),s.setNeedReload(!1)},0))});function Y(h){if(t.preventScroll||!P.value)return;const u=P.value.getBoundingClientRect().height-window.innerHeight;s.setNextScrollPosition(Math.max(0,Math.min(s.currentScrollPosition+h.wheel,u)))}H(()=>{t.preventScroll||s.isMounted&&(s.isTriggeringScrollPosition||(s.setIsEnabled(D()),s.isEnabled?s.setCurrentScrollPosition(U(s.currentScrollPosition,s.nextScrollPosition,l.value.smoothness)):(s.setCurrentScrollPosition(window.scrollY),s.setNextScrollPosition(window.scrollY))))},l.value.renderDelay);function D(){return(l.value.enableOnTouchDevices||s.deviceType==="desktop")&&window.innerWidth>=l.value.minWidth}const T=n.computed(()=>s.isEnabled?{transform:`translate3d(0, ${-s.currentScrollPosition}px, 0)`}:{});return(h,u)=>(n.openBlock(),n.createElementBlock("div",{class:n.normalizeClass([n.unref(l).defaultClassNames.smoothPage,n.unref(l).additionalClassNames.smoothPage])},[n.createElementVNode("div",{ref_key:"contentRef",ref:P,style:n.normalizeStyle(n.unref(T)),class:n.normalizeClass([n.unref(l).defaultClassNames.smoothPageBody,n.unref(l).additionalClassNames.smoothPageBody])},[n.renderSlot(h.$slots,"default")],6)],2))}});const K=B.defineStore("publicSmoothPage",()=>{const e=W();return{currentScrollPosition:e.currentScrollPosition,isEnabled:e.isEnabled,isTriggeringScrollPosition:e.isTriggeringScrollPosition,isMounted:e.isMounted,isInited:e.isInited,deviceType:e.deviceType,reload:e.reload}}),V={install(e,t){e.component("SmoothPage",q),e.provide("smoothPageSettings",t||{})}};exports.SmoothPage=q;exports.default=V;exports.useSmoothPage=K;
